<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">

<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;example.com&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Pisces&quot;,&quot;version&quot;:&quot;8.4.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:true,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:true,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;},&quot;path&quot;:&quot;&#x2F;search.xml&quot;,&quot;localsearch&quot;:{&quot;enable&quot;:true,&quot;trigger&quot;:&quot;auto&quot;,&quot;top_n_per_article&quot;:1,&quot;unescape&quot;:true,&quot;preload&quot;:false}}</script>
<meta property="og:type" content="article">
<meta property="og:title" content="k8s生产环境高可用部署">
<meta property="og:url" content="http://example.com/2022/05/11/k8s1-10-1%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/index.html">
<meta property="og:site_name" content="匆匆那年">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/05/11/k8s1-10-1%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/1651979590369.jpg">
<meta property="article:published_time" content="2022-05-11T01:40:11.000Z">
<meta property="article:modified_time" content="2022-05-11T01:51:31.426Z">
<meta property="article:author" content="jiajialinli">
<meta property="article:tag" content="k8s1.10.1">
<meta property="article:tag" content="deployment">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/05/11/k8s1-10-1%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/1651979590369.jpg">


<link rel="canonical" href="http://example.com/2022/05/11/k8s1-10-1%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:false,&quot;isPost&quot;:true,&quot;lang&quot;:&quot;zh-CN&quot;,&quot;comments&quot;:true,&quot;permalink&quot;:&quot;http:&#x2F;&#x2F;example.com&#x2F;2022&#x2F;05&#x2F;11&#x2F;k8s1-10-1%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2&#x2F;&quot;,&quot;path&quot;:&quot;2022&#x2F;05&#x2F;11&#x2F;k8s1-10-1高可用部署&#x2F;&quot;,&quot;title&quot;:&quot;k8s生产环境高可用部署&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>k8s生产环境高可用部署 | 匆匆那年</title><script src="/js/config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">匆匆那年</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">10</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">3</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">8</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-number">1.</span> <span class="nav-text">环境准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E"><span class="nav-number">1.1.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E5%A4%87"><span class="nav-number">1.2.</span> <span class="nav-text">设备</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Keepalived-%E5%92%8C-HAproxy"><span class="nav-number">2.</span> <span class="nav-text">安装 Keepalived 和 HAproxy</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8etcd%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2"><span class="nav-number">3.</span> <span class="nav-text">高可用etcd集群部署</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E7%AD%BE%E5%90%8DCA%E6%A0%B9%E8%AF%81%E4%B9%A6"><span class="nav-number">3.1.</span> <span class="nav-text">创建自签名CA根证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAetcd%E6%9C%8D%E5%8A%A1%E7%AB%AFCA"><span class="nav-number">3.2.</span> <span class="nav-text">创建etcd服务端CA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90etcd%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AF%81%E4%B9%A6"><span class="nav-number">3.3.</span> <span class="nav-text">生成etcd服务端证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90etcd%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AF%81%E4%B9%A6"><span class="nav-number">3.4.</span> <span class="nav-text">生成etcd客户端证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85etcd"><span class="nav-number">3.5.</span> <span class="nav-text">安装etcd</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEsystemd%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.5.1.</span> <span class="nav-text">配置systemd服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5"><span class="nav-number">3.5.2.</span> <span class="nav-text">健康检查</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%9B%86%E7%BE%A4"><span class="nav-number">4.</span> <span class="nav-text">初始化集群</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="nav-number">4.1.</span> <span class="nav-text">前提条件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E7%AC%AC%E4%B8%80%E4%B8%AAmaster"><span class="nav-number">4.2.</span> <span class="nav-text">初始化第一个master</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96masterN"><span class="nav-number">4.3.</span> <span class="nav-text">初始化masterN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%B7%E8%B4%9D%E8%AF%81%E4%B9%A6%E6%96%87%E4%BB%B6"><span class="nav-number">4.3.1.</span> <span class="nav-text">拷贝证书文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEkubectl-config%E6%96%87%E4%BB%B6"><span class="nav-number">4.4.</span> <span class="nav-text">配置kubectl config文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tab%E9%94%AE%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%A8"><span class="nav-number">4.5.</span> <span class="nav-text">tab键命令补全</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-number">4.6.</span> <span class="nav-text">测试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">5.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="jiajialinli"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">jiajialinli</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">8</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jiajialinli" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jiajialinli" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:dhxyljl@126.com" title="E-Mail → mailto:dhxyljl@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.baidu.com/" title="https:&#x2F;&#x2F;www.baidu.com" rel="noopener" target="_blank">百度</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
<div id="music163player">
    <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=38592976&auto=1&height=66">
    </iframe>
</div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/jiajialinli" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/11/k8s1-10-1%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiajialinli">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="匆匆那年">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          k8s生产环境高可用部署
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-11 09:40:11 / 修改时间：09:51:31" itemprop="dateCreated datePublished" datetime="2022-05-11T09:40:11+08:00">2022-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    
      <a title="changyan" href="/2022/05/11/k8s1-10-1%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/#SOHUCS" itemprop="discussionUrl">
        <span id="changyan_count_unit" class="post-comments-count hc-comment-count" data-xid="2022/05/11/k8s1-10-1高可用部署/" itemprop="commentCount"></span>
      </a>
    
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <img src="/2022/05/11/k8s1-10-1%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/1651979590369.jpg" class="">

<span id="more"></span>

<h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>​        单主节点集群大致足以供开发和测试环境使用，节点参数调整请看这里<a href="#">Post not found: 查看单集群部署 k8s1.10.1实验环境搭建</a>。</p>
<p>​        对于生产环境，您需要考虑集群的高可用性。如果关键组件（例如 kube-apiserver、kube-scheduler 和 kube-controller-manager）都在同一个主节点上运行，一旦主节点宕机，Kubernetes 将不可用。因此，需要为多个主节点配置负载均衡器，以创建高可用集群。您可以使用任意云负载均衡器或者任意硬件负载均衡器（例如 F5）。此外，也可以使用 Keepalived 和 <a target="_blank" rel="noopener" href="https://www.haproxy.com/">HAproxy</a>，或者 Nginx 来创建高可用集群。</p>
<p>​        本文采用Keepalived和HAproxy进行部署，经济性好，但是性能相较于硬件负载均衡器有所降低，如何取舍取决与企业自身条件。</p>
<h2 id="设备"><a href="#设备" class="headerlink" title="设备"></a>设备</h2><table>
<thead>
<tr>
<th>身份</th>
<th>名称</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>master1</td>
<td>ljl-centos7-m1</td>
<td>172.16.248.210</td>
</tr>
<tr>
<td>master2</td>
<td>ljl-centos7-m2</td>
<td>172.16.248.213</td>
</tr>
<tr>
<td>master3</td>
<td>ljl-centos7-m3</td>
<td>172.16.248.214</td>
</tr>
<tr>
<td>node1</td>
<td>ljl-centos7-n1</td>
<td>172.16.248.211</td>
</tr>
<tr>
<td>node2</td>
<td>ljl-centos7-n2</td>
<td>172.16.248.212</td>
</tr>
</tbody></table>
<h1 id="安装-Keepalived-和-HAproxy"><a href="#安装-Keepalived-和-HAproxy" class="headerlink" title="安装 Keepalived 和 HAproxy"></a>安装 Keepalived 和 HAproxy</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install keepalived haproxy psmisc -y</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/haproxy/haproxy.cfg</span><br></pre></td></tr></table></figure>

<details>
  <summary>haproxy.cfg</summary>
  <pre><code> 
global
    log /dev/log  local0 warning
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    maxconn     4000
    user        haproxy
    group       haproxy
    daemon
    stats socket /var/lib/haproxy/stats
defaults
  log global
  option  httplog
  option  dontlognull
        timeout connect 5000
        timeout client 50000
        timeout server 50000
frontend kube-apiserver
  bind *:9443
  mode tcp
  option tcplog
  default_backend kube-apiserver
backend kube-apiserver
    mode tcp
    option tcplog
    option tcp-check
    balance roundrobin
    default-server inter 10s downinter 5s rise 2 fall 2 slowstart 60s maxconn 250 maxqueue 256 weight 100
    server ljl-centos7-m1 172.16.248.210:6443 check 
    server ljl-centos7-m2 172.16.248.213:6443 check 
    server ljl-centos7-m3 172.16.248.214:6443 check  
  </code></pre>
</details>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable haproxy</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/keepalived/keepalived.conf</span><br></pre></td></tr></table></figure>

<details>
  <summary>keepalived.conf</summary>
  <pre><code>
global_defs &#123;
  notification_email &#123;
  &#125;
  router_id LVS_DEVEL
  vrrp_skip_check_adv_addr
  vrrp_garp_interval 0
  vrrp_gna_interval 0
&#125;
vrrp_script chk_haproxy &#123;
  script "killall -0 haproxy"
  interval 2
  weight 2
&#125;
vrrp_instance haproxy-vip &#123;
  state BACKUP
  priority 100
  interface ens160                   
  virtual_router_id 60
  advert_int 1
  authentication &#123;
    auth_type PASS
    auth_pass 1111
  &#125;
  unicast_src_ip 172.16.248.210
  unicast_peer &#123;
    172.16.248.213
    172.16.248.214
  &#125;
  virtual_ipaddress &#123;
    172.16.248.221/24
  &#125;
  track_script &#123;
    chk_haproxy
  &#125;
&#125;
  </code></pre>
</details>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable keepalived</span><br></pre></td></tr></table></figure>

<h1 id="高可用etcd集群部署"><a href="#高可用etcd集群部署" class="headerlink" title="高可用etcd集群部署"></a>高可用etcd集群部署</h1><h2 id="创建自签名CA根证书"><a href="#创建自签名CA根证书" class="headerlink" title="创建自签名CA根证书"></a>创建自签名CA根证书</h2><p>CA证书的制作可以使用openssl、easyrsa、cfssl等工具完成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/kubernetes/pki/etcd &amp;&amp; cd /etc/kubernetes/pki/etcd</span><br><span class="line">openssl genrsa -out ca.key 2048</span><br><span class="line">openssl req -x509 -new -nodes -key ca.key -subj &quot;/CN=172.16.248.210&quot; -days 36500  -out ca.crt</span><br></pre></td></tr></table></figure>

<blockquote>
<p>◎ -subj：“/CN”的值为Master主机名或IP地址。<br>◎ -days：设置证书的有效期。</p>
</blockquote>
<h2 id="创建etcd服务端CA"><a href="#创建etcd服务端CA" class="headerlink" title="创建etcd服务端CA"></a>创建etcd服务端CA</h2><p>先创建一个x509 v3配置文件etcd_ssl.cnf，其中subjectAltName参数（alt_names）包括所有etcd主机的IP地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;./etcd_ssl.cnf</span><br><span class="line">[ req]</span><br><span class="line">req_extensions = v3_req</span><br><span class="line">distinguished_name = req_distinguished_name</span><br><span class="line"></span><br><span class="line">[ req_distinguished_name ]</span><br><span class="line"></span><br><span class="line">[ v3_req ]</span><br><span class="line">basicConstraints = CA:FALSE</span><br><span class="line">keyUsage = nonRepudiation,digitalSignature,keyEncipherment</span><br><span class="line">subjectAltName = @alt_names </span><br><span class="line"></span><br><span class="line">[ alt_names ]</span><br><span class="line">IP.1 = 172.16.248.210</span><br><span class="line">IP.2 = 172.16.248.213</span><br><span class="line">IP.3 = 172.16.248.214</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="生成etcd服务端证书"><a href="#生成etcd服务端证书" class="headerlink" title="生成etcd服务端证书"></a>生成etcd服务端证书</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out server.key 2048 </span><br><span class="line">openssl req -new -key server.key -config etcd_ssl.cnf -subj &quot;/CN=etcd-server&quot; -out etcd_server.csr </span><br><span class="line">openssl x509 -req -in etcd_server.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -days 36500 -extensions v3_req -extfile etcd_ssl.cnf -out server.crt</span><br></pre></td></tr></table></figure>

<h2 id="生成etcd客户端证书"><a href="#生成etcd客户端证书" class="headerlink" title="生成etcd客户端证书"></a>生成etcd客户端证书</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out peer.key 2048 </span><br><span class="line">openssl req -new -key peer.key -config etcd_ssl.cnf -subj &quot;/CN=etcd-client&quot; -out etcd_peer.csr </span><br><span class="line">openssl x509 -req -in etcd_peer.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -days 36500 -extensions v3_req -extfile etcd_ssl.cnf -out peer.crt</span><br></pre></td></tr></table></figure>

<p>将所有证书拷贝到其他节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r /etc/kubernetes/pki/etcd 172.16.248.213:/etc/kubernetes/pki</span><br><span class="line">scp -r /etc/kubernetes/pki/etcd 172.16.248.214:/etc/kubernetes/pki</span><br></pre></td></tr></table></figure>

<h2 id="安装etcd"><a href="#安装etcd" class="headerlink" title="安装etcd"></a>安装etcd</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ETCD_VERSION=v3.1.12</span><br><span class="line">curl -sSL https://github.com/coreos/etcd/releases/download/$&#123;ETCD_VERSION&#125;/etcd-$&#123;ETCD_VERSION&#125;-linux-amd64.tar.gz | tar -xzv --strip-components=1 -C /usr/local/bin/</span><br></pre></td></tr></table></figure>

<h3 id="配置systemd服务"><a href="#配置systemd服务" class="headerlink" title="配置systemd服务"></a>配置systemd服务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/lib/etcd</span><br><span class="line">cat &lt;&lt;EOF &gt;/usr/lib/systemd/system/etcd.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Etcd Server</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line">Documentation=https://github.com/coreos</span><br><span class="line"> </span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">WorkingDirectory=/var/lib/etcd/</span><br><span class="line">ExecStart=/usr/local/bin/etcd   \</span><br><span class="line">    --name ljl-centos7-m3   \</span><br><span class="line">    --cert-file=/etc/kubernetes/pki/etcd/server.crt   \</span><br><span class="line">    --key-file=/etc/kubernetes/pki/etcd/server.key   \</span><br><span class="line">    --peer-cert-file=/etc/kubernetes/pki/etcd/peer.crt   \</span><br><span class="line">    --peer-key-file=/etc/kubernetes/pki/etcd/peer.key   \</span><br><span class="line">    --trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt   \</span><br><span class="line">    --peer-trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt   \</span><br><span class="line">    --initial-advertise-peer-urls https://172.16.248.214:2380   \</span><br><span class="line">    --listen-peer-urls https://172.16.248.214:2380   \</span><br><span class="line">    --listen-client-urls https://172.16.248.214:2379,http://127.0.0.1:2379   \</span><br><span class="line">    --advertise-client-urls https://172.16.248.214:2379   \</span><br><span class="line">    --initial-cluster-token etcd-cluster-0   \</span><br><span class="line">    --initial-cluster ljl-centos7-m1=https://172.16.248.210:2380,ljl-centos7-m2=https://172.16.248.213:2380,ljl-centos7-m3=https://172.16.248.214:2380   \</span><br><span class="line">    --initial-cluster-state new   \</span><br><span class="line">    --client-cert-auth=true   \</span><br><span class="line">    --peer-client-cert-auth=true   \</span><br><span class="line">    --data-dir=/var/lib/etcd</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"> </span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>如果你的主机名和ip跟教程的不一样，请确保更换–name与相应的IPv4地址。此外，请确保你更换的每台机器的主机名，能够使用DNS访问，或确保添加记录/etc/hosts；</li>
<li>指定 etcd 的工作目录和数据目录为 /var/lib/etcd，需在启动服务前创建这个目录；</li>
<li>为了保证通信安全，需要指定 etcd 的公私钥(cert-file和key-file)、Peers 通信的公私钥和 CA 证书(peer-cert-file、peer-key-file、peer-trusted-ca-file)、客户端的CA证书（trusted-ca-file）；</li>
</ul>
</blockquote>
<p>第二种方法</p>
<details>
  <summary>点击展开</summary>
  <pre><code> 
cat <<EOF >/usr/lib/systemd/system/etcd.service
[Unit] 
Dscriptiontd=key-valuestore 
Documentation=https://github.com/etcd-io/etcd After=network.target 
[Service] 
EnvironmentFile=/etc/etcd/etcd.conf 
ExecStart=/usr/local/bin/etcd
Restart=always 
[Install] 
WantedBy=multi-user.target
EOF
&nbsp;
mkdir /etc/etcd
cat <<EOF >/etc/etcd/etcd.conf
ETCD_NAME=ljl-centos7-m3
ETCD_DATA_DIR=/etc/etcd/data 
ETCD_CERT_FILE=/etc/etcd/pki/etcd_server.crt 
ETCD_KEY_FILE=/etc/etcd/pki/etcd_server.key 
ETCD_TRUSTED_CA_FILE=/etc/kubernetes/pki/ca.crt
ETCD_CLIENT_CERT_AUTH=true 
ETCD_LISTEN_CLIENT_URLS=https://172.16.248.214:2379
ETCD_ADVERTISE_CLIENT_URLS=https://172.16.248.214:2379
ETCD_PEER_CERT_FILE=/etc/etcd/pki/etcd_server.crt 
ETCD_PEER_KEY_FILE=/etc/etcd/pki/etcd_server.key 
ETCD_PEER_TRUSTED_CA_FILE=/etc/kubernetes/pki/ca.crt 
ETCD_LISTEN_PEER_URLS=https://172.16.248.214:2380 
ETCD_INITIAL_ADVERTISE_PEER_URLS=https://172.16.248.214:2380 ETCD_INITIAL_CLUSTER_TOKEN=etcd-cluster 
ETCD_INITIAL_CLUSTER="ljl-centos7-m1 =https://172.16.248.210:2380,ljl-centos7-m2=https://172.16.248.213:2380,ljl-centos7-m3=https:/172.16.248.214:2380"
EOF
  </code></pre>
</details>
### 启动服务

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable etcd --now</span><br></pre></td></tr></table></figure>

<h3 id="健康检查"><a href="#健康检查" class="headerlink" title="健康检查"></a>健康检查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@ljl-centos7-m1 ~]<span class="comment"># etcdctl -endpoints=https://172.16.248.210:2379,https://172.16.248.213:2379,https://172.16.248.214:2379 -ca-file=/etc/kubernetes/pki/etcd/ca.crt -cert-file=/etc/kubernetes/pki/etcd/server.crt -key-file=/etc/kubernetes/pki/etcd/server.key cluster-health</span></span><br><span class="line">2022-05-10 10:49:25.457174 I | warning: ignoring ServerName <span class="keyword">for</span> user-provided CA <span class="keyword">for</span> backwards compatibility is deprecated</span><br><span class="line">2022-05-10 10:49:25.458542 I | warning: ignoring ServerName <span class="keyword">for</span> user-provided CA <span class="keyword">for</span> backwards compatibility is deprecated</span><br><span class="line">member 71aad14d35084bfd is healthy: got healthy result from https://172.16.248.213:2379</span><br><span class="line">member 77254e7dcb3087cd is healthy: got healthy result from https://172.16.248.210:2379</span><br><span class="line">member c2d8166cb1fd5f88 is healthy: got healthy result from https://172.16.248.214:2379</span><br><span class="line">cluster is healthy</span><br><span class="line">[root@ljl-cnetos7-m2 ~]<span class="comment"># curl -L http://127.0.0.1:2379/health</span></span><br><span class="line">&#123;<span class="string">&quot;health&quot;</span>: <span class="string">&quot;true&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<h1 id="初始化集群"><a href="#初始化集群" class="headerlink" title="初始化集群"></a>初始化集群</h1><h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><pre><code>    按单主节点模式，设备参数调整完毕，软件docker、kubeadm、kubelet、kubectl安装完毕。
</code></pre>
<h2 id="初始化第一个master"><a href="#初始化第一个master" class="headerlink" title="初始化第一个master"></a>初始化第一个master</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; config.yaml </span><br><span class="line">apiVersion: kubeadm.k8s.io/v1alpha1</span><br><span class="line">kind: MasterConfiguration</span><br><span class="line">etcd:</span><br><span class="line">  endpoints:</span><br><span class="line">  - https://172.16.248.210:2379</span><br><span class="line">  - https://172.16.248.213:2379</span><br><span class="line">  - https://172.16.248.214:2379</span><br><span class="line">  caFile: /etc/kubernetes/pki/ca.crt</span><br><span class="line">  certFile: /etc/kubernetes/pki/etcd/server.crt</span><br><span class="line">  keyFile: /etc/kubernetes/pki/etcd/server.key</span><br><span class="line">  dataDir: /var/lib/etcd</span><br><span class="line">networking:</span><br><span class="line">  podSubnet: 10.244.0.0/16</span><br><span class="line">kubernetesVersion: 1.10.1</span><br><span class="line">api:</span><br><span class="line">  advertiseAddress: &quot;172.16.248.210&quot;</span><br><span class="line">  #advertiseAddress: &quot;172.16.248.221:9443&quot;</span><br><span class="line">  #这里应该写每个主机的IP地址，写负载均衡器地址会出问题</span><br><span class="line">#token: &quot;b99a00.a144ef80536d4344&quot;</span><br><span class="line">#tokenTTL: &quot;0s&quot;	## token 永不失效</span><br><span class="line">apiServerCertSANs:</span><br><span class="line">- ljl-centos7-m1</span><br><span class="line">- ljl-centos7-m2</span><br><span class="line">- ljl-centos7-m3</span><br><span class="line">- 172.16.248.210</span><br><span class="line">- 172.16.248.213</span><br><span class="line">- 172.16.248.214</span><br><span class="line">- 172.16.248.221</span><br><span class="line">featureGates:</span><br><span class="line">  CoreDNS: true</span><br><span class="line">#imageRepository: &quot;registry.cn-hangzhou.aliyuncs.com/k8sth&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --config config.yaml </span><br></pre></td></tr></table></figure>

<h2 id="初始化masterN"><a href="#初始化masterN" class="headerlink" title="初始化masterN"></a>初始化masterN</h2><h3 id="拷贝证书文件"><a href="#拷贝证书文件" class="headerlink" title="拷贝证书文件"></a>拷贝证书文件</h3><p>将第一个master生成的证书拷贝到其他节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r /etc/kubernetes/pki/ 172.16.248.213:/etc/kubernetes/</span><br><span class="line">scp -r /etc/kubernetes/pki/ 172.16.248.214:/etc/kubernetes/</span><br></pre></td></tr></table></figure>

<p>执行第一个master的所有步骤</p>
<blockquote>
<p>注意：修改config.yaml中的IP地址</p>
</blockquote>
<h2 id="配置kubectl-config文件"><a href="#配置kubectl-config文件" class="headerlink" title="配置kubectl config文件"></a>配置kubectl config文件</h2><p>修改server地址为负载均衡器地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ljl-centos7-m1 ~]# vim ~/.kube/config</span><br><span class="line">server: https://172.16.248.221:9443</span><br></pre></td></tr></table></figure>

<h2 id="tab键命令补全"><a href="#tab键命令补全" class="headerlink" title="tab键命令补全"></a>tab键命令补全</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y  install bash-completion &amp;&amp; source /usr/share/bash-completion/bash_completion &amp;&amp; source &lt;(kubectl completion bash) &amp;&amp; echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure>



<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><blockquote>
<p>随便杀进程，只要有一个master是活的，就可以提供服务。</p>
</blockquote>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://yuerblog.cc/2018/11/19/k8s%E7%B3%BB%E5%88%97-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/#post-3948-_Toc530145006">k8s系列 - 高可用集群搭建 | 鱼儿的博客 (yuerblog.cc)</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1115558">Kubernetes1.10 HA高可用集群搭建文档 - 云+社区 - 腾讯云 (tencent.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_34010566/article/details/91614352">K8S 1.10.1 高可用环境搭建实战_weixin_34010566的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/chenleiking/article/details/80136449">使用Kubeadm搭建Kubernetes HA（1.10.1）_迷途的攻城狮（798570156）的博客-CSDN博客</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button onclick="document.querySelector('.post-reward').classList.toggle('active');">
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/pay/alipay.png" alt="jiajialinli 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/k8s1-10-1/" rel="tag"><i class="fa fa-tag"></i> k8s1.10.1</a>
              <a href="/tags/deployment/" rel="tag"><i class="fa fa-tag"></i> deployment</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/05/09/k8s%E8%AF%81%E4%B9%A6%E6%9B%B4%E6%96%B0/" rel="prev" title="k8s证书更新">
                  <i class="fa fa-chevron-left"></i> k8s证书更新
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="SOHUCS"></div><script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jiajialinli</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">39k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">35 分钟</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date(); 
    function createtime() { 
        var grt= new Date("05/22/2021 17:08:20");//在此处修改你的建站时间，格式：月/日/年 时:分:秒
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
setInterval("createtime()",250);
</script>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/third-party/search/local-search.js"></script>






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<script class="next-config" data-name="changyan" type="application/json">{&quot;enable&quot;:true,&quot;appid&quot;:&quot;cyvtfml6g&quot;,&quot;appkey&quot;:&quot;e731448e5dc22bd7ea7e9fbafa2f6589&quot;}</script>
<script src="/js/third-party/comments/changyan.js"></script>



<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>


</body>
</html>
